# Will Styler
# Markdown to LaTeX Dissertation Build Script

# Captures the date for later use
date=`date +"%m-%d-%y-%H%M"`

# Move into the build folder
cd /Users/iNge/Documents/Modul2Aufgabe1



# Gather the files which together constitute a dissertation into one place.
cat /Users/iNge/Documents/Modul2Aufgabe1/kommentare.md > biblio.md



# Run Pandoc to turn the markdown file with the bulk of the document into a .TeX file
pandoc kommentare.md -o kommentare.tex


# Concatenate the header file (with the preambles, TOC, etc), the pandoc-created TeX file, and the footer file (with the bibliography) into a single buildable TeX file
cat /Users/iNge/Documents/Modul2Aufgabe1/header.tex /Users/iNge/Documents/Modul2Aufgabe1/kommentare.tex /Users/iNge/Documents/Modul2Aufgabe1/footer.tex > /Users/iNge/Documents/Modul2Aufgabe1/bibliographiekom.tex



/usr/local/texlive/2015/bin/x86_64-darwin/pdflatex -file-line-error -interaction=nonstopmode -synctex=1 -enable-write18 -output-directory=/Users/iNge/Documents/Modul2Aufgabe1 bibliographiekom.tex

/usr/local/texlive/2015/bin/x86_64-darwin/biber /Users/iNge/Documents/Modul2Aufgabe1/bibliographiekom.bcf


#/usr/texbin/pdflatex -file-line-error -interaction=nonstopmode -synctex=1 -output-directory=/Users/iNge/Documents/Modul2Aufgabe1/bibliographiekom.tex

#/usr/texbin/biber /Users/iNge/Documents/Modul2Aufgabe1/bibliographiekom.bcf

/usr/local/texlive/2015/bin/x86_64-darwin/pdflatex -file-line-error -interaction=nonstopmode -synctex=1 -enable-write18 -output-directory=/Users/iNge/Documents/Modul2Aufgabe1/ bibliographiekom.tex

#/usr/texbin/pdflatex -file-line-error -interaction=nonstopmode -synctex=1 -output-directory=/Users/iNge/Documents/Modul2Aufgabe1/ bibliographiekom.tex

open /Applications/Skim.app /Users/iNge/Documents/Modul2Aufgabe1/bibliographiekom.pdf

# open /Applications/Texpad.app /Users/iNge/Dropbox/Scripttest/Ingeforscherplan.tex

# Build the TeX once without stopping for errors (as the hyperref plugin throws errors on the first run)
# /usr/texbin/xelatex -output-driver="/usr/texbin/xdvipdfmx" -interaction=nonstopmode -synctex=1 Stylerdissertation



# Render the file twice more, to ensure that the bibliographical references are included and that the TOC reflects everything accurately
# /usr/texbin/xelatex -output-driver="/usr/texbin/xdvipdfmx" -synctex=1 Stylerdissertation
# /usr/texbin/xelatex -output-driver="/usr/texbin/xdvipdfmx" -synctex=1  Stylerdissertation

# Open the PDF generated in my PDF reader of choice
# open /Applications/Skim.app ~/Documents/dissertation/0_build/Stylerdissertation.pdf

# Copy the PDF and final TeX out of the build folder for accessibility
cp bibliographiekom.tex /Users/iNge/Dropbox/Finale/bibliographiekom.tex
cp bibliographiekom.pdf /Users/iNge/Dropbox/Finale/bibliographiekom.pdf

# Archives a copy of the md and tex files by date, leaving a trail of prior drafts
tar cfvz /Users/iNge/Documents/Modul2Aufgabe1/latest.tar.gz biblio.md bibliographiekom.tex titel.tex 

# Rename the archived version, including the date generated.
mv /Users/iNge/Documents/Modul2Aufgabe1/latest.tar.gz /Users/iNge/Dropbox/Backup/inge_biblio_$date.tar.gz

# Jetzt noch alles in Git
git commit -a
git push


